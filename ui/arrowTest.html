<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Playground</title>
    <style type="text/css" media="screen">
        body {
            background: #222;
            color: #fff;
            font: 300 100.1% "Helvetica Neue", Helvetica, "Arial Unicode MS", Arial, sans-serif;
        }
        #holder {
            position: absolute;
            width: auto;
            height: auto;
            left: 60px;
            top: 70px;
            right: 60px;
            bottom: 10px;
            margin: 0;
            padding: 0;
            border: 1px solid black;
            -moz-border-radius: 10px;
            -webkit-border-radius: 10px;
            background: #333;
        }
        #miniholder {
            position: absolute;
            width: 200px;
            height: 100px;
            right: 80px;
            bottom: 30px;
            margin: 0;
            padding: 0;
            background: rgba(32,32,32,.5);
        }
        #icons-generic {
            position: absolute;
            width: 40px;
            height: auto;
            left: 10px;
            top: 70px;
            bottom: 10px;
            margin: 0;
            padding: 0;
        }
        #icons-specific {
            position: absolute;
            width: 40px;
            height: auto;
            right: 10px;
            top: 70px;
            bottom: 10px;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="holder"></div>
    <div id="miniholder"></div>
    <div id="icons-generic"></div>
    <div id="icons-specific"></div>
</body>
<script type="text/javascript" src="assets/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="assets/jquery.mousewheel.js"></script>
<script type="text/javascript" src="assets/raphael.js"></script>
<script type="text/javascript" src="assets/graffle.js"></script>
<script type="text/javascript">
(function(){
    var el;
    var scale=1;
    var dragger = function () {
        this.ox = this.type == "rect" ? this.attr("x") : this.attr("cx");
        this.oy = this.type == "rect" ? this.attr("y") : this.attr("cy");
        this.animate({"fill-opacity": .2}, 500);
    },
    move = function (dx, dy) {
        var att = this.type == "rect" ? {x: this.ox + dx, y: this.oy + dy} : {cx: this.ox + dx, cy: this.oy + dy};
        this.attr(att);
        for (var i = connections.length; i--;) {
            r.connection(connections[i]);
        }
        r.safari();
    },
    up = function () {
        this.animate({"fill-opacity": 0}, 500);
    };
    // r = Raphael("holder", "100%", "100%"),
    $('#miniholder').css({
        width:$('#holder').width()*0.17,
        height:$('#holder').height()*0.17
    });
    var r = Raphael("holder", "100%", "100%"),
    r2 = Raphael("miniholder", "100%", "100%"),
    icons_g = Raphael("icons-generic", "100%", "100%"),
    icons_s = Raphael("icons-specific", "100%", "100%"),
    connections = [],
    shapes = [  r.ellipse(190, 100, 30, 20),
                r.rect(290, 80, 60, 40, 10),
                r.rect(290, 180, 60, 40, 2),
                r.ellipse(450, 100, 20, 20)
            ];
    for (var i = 0, ii = shapes.length; i < ii; i++) {
        var color = Raphael.getColor();
        shapes[i].attr({fill: color, stroke: color, "fill-opacity": 0, "stroke-width": 2, cursor: "move"});
        shapes[i].drag(move, dragger, up);
    }
    connections.push(r.connection(shapes[0], shapes[1], "#fff"));
    connections.push(r.connection(shapes[1], shapes[2], "#fff", "#fff|5"));
    connections.push(r.connection(shapes[1], shapes[3], "#000", "#fff"));


    var icons = { zoomin: "M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM15.687,9.051h-4v2.833H8.854v4.001h2.833v2.833h4v-2.834h2.832v-3.999h-2.833V9.051z",
    zoomout: "M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM8.854,11.884v4.001l9.665-0.001v-3.999L8.854,11.884z",
    nodes: "M6.812,17.202l7.396-3.665v-2.164h-0.834c-0.414,0-0.808-0.084-1.167-0.237v1.159l-7.396,3.667v2.912h2V17.202zM26.561,18.875v-2.913l-7.396-3.666v-1.158c-0.358,0.152-0.753,0.236-1.166,0.236h-0.832l-0.001,2.164l7.396,3.666v1.672H26.561zM16.688,18.875v-7.501h-2v7.501H16.688zM27.875,19.875H23.25c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2h4.625c1.104,0,2-0.896,2-2v-4.625C29.875,20.771,28.979,19.875,27.875,19.875zM8.125,19.875H3.5c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2h4.625c1.104,0,2-0.896,2-2v-4.625C10.125,20.771,9.229,19.875,8.125,19.875zM13.375,10.375H18c1.104,0,2-0.896,2-2V3.75c0-1.104-0.896-2-2-2h-4.625c-1.104,0-2,0.896-2,2v4.625C11.375,9.479,12.271,10.375,13.375,10.375zM18,19.875h-4.625c-1.104,0-2,0.896-2,2V26.5c0,1.104,0.896,2,2,2H18c1.104,0,2-0.896,2-2v-4.625C20,20.771,19.104,19.875,18,19.875z",
    undo: "M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",
    left: "M20.834,8.037L9.641,14.5c-1.43,0.824-1.43,2.175,0,3l11.193,6.463c1.429,0.826,2.598,0.15,2.598-1.5V9.537C23.432,7.887,22.263,7.211,20.834,8.037z",
    right: "M11.166,23.963L22.359,17.5c1.43-0.824,1.43-2.175,0-3L11.166,8.037c-1.429-0.826-2.598-0.15-2.598,1.5v12.926C8.568,24.113,9.737,24.789,11.166,23.963z",
    top: "M23.963,20.834L17.5,9.64c-0.825-1.429-2.175-1.429-3,0L8.037,20.834c-0.825,1.429-0.15,2.598,1.5,2.598h12.926C24.113,23.432,24.788,22.263,23.963,20.834z",
    bottom: "M8.037,11.166L14.5,22.359c0.825,1.43,2.175,1.43,3,0l6.463-11.194c0.826-1.429,0.15-2.598-1.5-2.598H9.537C7.886,8.568,7.211,9.737,8.037,11.166z",
    shrink: "M25.083,18.895l-8.428-2.259l2.258,8.428l1.838-1.837l7.053,7.053l2.476-2.476l-7.053-7.053L25.083,18.895zM5.542,11.731l8.428,2.258l-2.258-8.428L9.874,7.398L3.196,0.72L0.72,3.196l6.678,6.678L5.542,11.731zM7.589,20.935l-6.87,6.869l2.476,2.476l6.869-6.869l1.858,1.857l2.258-8.428l-8.428,2.258L7.589,20.935zM23.412,10.064l6.867-6.87l-2.476-2.476l-6.868,6.869l-1.856-1.856l-2.258,8.428l8.428-2.259L23.412,10.064z",
    expand: "M25.545,23.328,17.918,15.623,25.534,8.007,27.391,9.864,29.649,1.436,21.222,3.694,23.058,5.53,15.455,13.134,7.942,5.543,9.809,3.696,1.393,1.394,3.608,9.833,5.456,8.005,12.98,15.608,5.465,23.123,3.609,21.268,1.351,29.695,9.779,27.438,7.941,25.6,15.443,18.098,23.057,25.791,21.19,27.638,29.606,29.939,27.393,21.5z",
    run: "M3.25,6.469v19.062h25.5V6.469H3.25zM10.345,11.513l-4.331,1.926V12.44l3.124-1.288v-0.018L6.014,9.848v-1l4.331,1.927V11.513zM16.041,14.601h-5.05v-0.882h5.05V14.601z",
    bug: "M28.589,10.903l-5.828,1.612c-0.534-1.419-1.338-2.649-2.311-3.628l3.082-5.44c0.271-0.48,0.104-1.092-0.38-1.365c-0.479-0.271-1.09-0.102-1.36,0.377l-2.924,5.162c-0.604-0.383-1.24-0.689-1.9-0.896c-0.416-1.437-1.652-2.411-3.058-2.562c-0.001-0.004-0.002-0.008-0.003-0.012c-0.061-0.242-0.093-0.46-0.098-0.65c-0.005-0.189,0.012-0.351,0.046-0.479c0.037-0.13,0.079-0.235,0.125-0.317c0.146-0.26,0.34-0.43,0.577-0.509c0.023,0.281,0.142,0.482,0.352,0.601c0.155,0.088,0.336,0.115,0.546,0.086c0.211-0.031,0.376-0.152,0.496-0.363c0.105-0.186,0.127-0.389,0.064-0.607c-0.064-0.219-0.203-0.388-0.414-0.507c-0.154-0.087-0.314-0.131-0.482-0.129c-0.167,0.001-0.327,0.034-0.481,0.097c-0.153,0.063-0.296,0.16-0.429,0.289c-0.132,0.129-0.241,0.271-0.33,0.426c-0.132,0.234-0.216,0.496-0.25,0.783c-0.033,0.286-0.037,0.565-0.009,0.84c0.017,0.16,0.061,0.301,0.094,0.449c-0.375-0.021-0.758,0.002-1.14,0.108c-0.482,0.133-0.913,0.36-1.28,0.653c-0.052-0.172-0.098-0.344-0.18-0.518c-0.116-0.249-0.263-0.486-0.438-0.716c-0.178-0.229-0.384-0.41-0.618-0.543C9.904,3.059,9.737,2.994,9.557,2.951c-0.18-0.043-0.352-0.052-0.516-0.027s-0.318,0.08-0.463,0.164C8.432,3.172,8.318,3.293,8.23,3.445C8.111,3.656,8.08,3.873,8.136,4.092c0.058,0.221,0.181,0.384,0.367,0.49c0.21,0.119,0.415,0.138,0.611,0.056C9.31,4.556,9.451,4.439,9.539,4.283c0.119-0.21,0.118-0.443-0.007-0.695c0.244-0.055,0.497-0.008,0.757,0.141c0.081,0.045,0.171,0.115,0.27,0.208c0.097,0.092,0.193,0.222,0.286,0.388c0.094,0.166,0.179,0.368,0.251,0.608c0.013,0.044,0.023,0.098,0.035,0.146c-0.911,0.828-1.357,2.088-1.098,3.357c-0.582,0.584-1.072,1.27-1.457,2.035l-5.16-2.926c-0.48-0.271-1.092-0.102-1.364,0.377C1.781,8.404,1.95,9.016,2.43,9.289l5.441,3.082c-0.331,1.34-0.387,2.807-0.117,4.297l-5.828,1.613c-0.534,0.147-0.846,0.699-0.698,1.231c0.147,0.53,0.697,0.843,1.231,0.694l5.879-1.627c0.503,1.057,1.363,2.28,2.371,3.443l-3.194,5.639c-0.272,0.481-0.104,1.092,0.378,1.363c0.239,0.137,0.512,0.162,0.758,0.094c0.248-0.068,0.469-0.229,0.604-0.471l2.895-5.109c2.7,2.594,5.684,4.123,5.778,1.053c1.598,2.56,3.451-0.338,4.502-3.976l5.203,2.947c0.24,0.138,0.514,0.162,0.762,0.094c0.246-0.067,0.467-0.229,0.603-0.471c0.272-0.479,0.104-1.091-0.377-1.362l-5.701-3.229c0.291-1.505,0.422-2.983,0.319-4.138l5.886-1.627c0.53-0.147,0.847-0.697,0.696-1.229C29.673,11.068,29.121,10.756,28.589,10.903z",
    link: "M16.45,18.085l-2.47,2.471c0.054,1.023-0.297,2.062-1.078,2.846c-1.465,1.459-3.837,1.459-5.302-0.002c-1.461-1.465-1.46-3.836-0.001-5.301c0.783-0.781,1.824-1.131,2.847-1.078l2.469-2.469c-2.463-1.057-5.425-0.586-7.438,1.426c-2.634,2.637-2.636,6.907,0,9.545c2.638,2.637,6.909,2.635,9.545,0l0.001,0.002C17.033,23.511,17.506,20.548,16.45,18.085zM14.552,12.915l2.467-2.469c-0.053-1.023,0.297-2.062,1.078-2.848C19.564,6.139,21.934,6.137,23.4,7.6c1.462,1.465,1.462,3.837,0,5.301c-0.783,0.783-1.822,1.132-2.846,1.079l-2.469,2.468c2.463,1.057,5.424,0.584,7.438-1.424c2.634-2.639,2.633-6.91,0-9.546c-2.639-2.636-6.91-2.637-9.545-0.001C13.967,7.489,13.495,10.451,14.552,12.915zM18.152,10.727l-7.424,7.426c-0.585,0.584-0.587,1.535,0,2.121c0.585,0.584,1.536,0.584,2.121-0.002l7.425-7.424c0.584-0.586,0.584-1.535,0-2.121C19.687,10.141,18.736,10.142,18.152,10.727z",
    doc: "M23.024,5.673c-1.744-1.694-3.625-3.051-5.168-3.236c-0.084-0.012-0.171-0.019-0.263-0.021H7.438c-0.162,0-0.322,0.063-0.436,0.18C6.889,2.71,6.822,2.87,6.822,3.033v25.75c0,0.162,0.063,0.317,0.18,0.435c0.117,0.116,0.271,0.179,0.436,0.179h18.364c0.162,0,0.317-0.062,0.434-0.179c0.117-0.117,0.182-0.272,0.182-0.435V11.648C26.382,9.659,24.824,7.49,23.024,5.673zM22.157,6.545c0.805,0.786,1.529,1.676,2.069,2.534c-0.468-0.185-0.959-0.322-1.42-0.431c-1.015-0.228-2.008-0.32-2.625-0.357c0.003-0.133,0.004-0.283,0.004-0.446c0-0.869-0.055-2.108-0.356-3.2c-0.003-0.01-0.005-0.02-0.009-0.03C20.584,5.119,21.416,5.788,22.157,6.545zM25.184,28.164H8.052V3.646h9.542v0.002c0.416-0.025,0.775,0.386,1.05,1.326c0.25,0.895,0.313,2.062,0.312,2.871c0.002,0.593-0.027,0.991-0.027,0.991l-0.049,0.652l0.656,0.007c0.003,0,1.516,0.018,3,0.355c1.426,0.308,2.541,0.922,2.645,1.617c0.004,0.062,0.005,0.124,0.004,0.182V28.164z",
    warn: "M29.225,23.567l-3.778-6.542c-1.139-1.972-3.002-5.2-4.141-7.172l-3.778-6.542c-1.14-1.973-3.003-1.973-4.142,0L9.609,9.853c-1.139,1.972-3.003,5.201-4.142,7.172L1.69,23.567c-1.139,1.974-0.207,3.587,2.071,3.587h23.391C29.432,27.154,30.363,25.541,29.225,23.567zM16.536,24.58h-2.241v-2.151h2.241V24.58zM16.428,20.844h-2.023l-0.201-9.204h2.407L16.428,20.844z" };

    var holder_w = $('#holder').width(), 
        holder_h = $('#holder').height(), 
        iconsg_w = $('#icons-generic').width(), 
        iconsg_h = $('#icons-generic').height(), 
        iconss_w = $('#icons-specific').width(), 
        iconss_h = $('#icons-specific').height(),
        stroke_holder = {fill: "#456", stroke: "none"},
        stroke_holder_outer = {stroke: "#123", "stroke-width": 3, "stroke-linejoin": "round"};

    // Add icons for holder
    var holder_icons = { 
        "Zoom In": [ 
            r.path( icons["zoomin"] ).attr( stroke_holder_outer ).attr( {transform: ['t',holder_w-70,10]} ), 
            r.path( icons["zoomin"] ).attr( stroke_holder ).attr( {transform: ['t',holder_w-70,10]} ) ],
        "Zoom Out": [
            r.path( icons["zoomout"] ).attr( stroke_holder_outer ).attr( {transform: ['t',holder_w-40,10]} ),
            r.path( icons["zoomout"] ).attr( stroke_holder ).attr( {transform: ['t',holder_w-40,10]} ) ],
        "Move Up": [
            r.path( icons["top"] ).attr( stroke_holder_outer ).attr( {transform: ['t',holder_w/2-20,5]} ),
            r.path( icons["top"] ).attr( stroke_holder ).attr( {transform: ['t',holder_w/2-20,5]} ) ],
        "Move Down": [
            r.path( icons["bottom"] ).attr( stroke_holder_outer ).attr( {transform: ['t',holder_w/2-20,holder_h-37]} ),
            r.path( icons["bottom"] ).attr( stroke_holder ).attr( {transform: ['t',holder_w/2-20,holder_h-37]} ) ],
        "Move Right": [
            r.path( icons["right"] ).attr( stroke_holder_outer ).attr( {transform: ['t',holder_w-37,holder_h/2-20]} ),
            r.path( icons["right"] ).attr( stroke_holder ).attr( {transform: ['t',holder_w-37,holder_h/2-20]} ) ],
        "Move Left": [
            r.path( icons["left"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,holder_h/2-20]} ),
            r.path( icons["left"] ).attr( stroke_holder ).attr( {transform: ['t',5,holder_h/2-20]} ) ]
    }
    
    // Add icons to generic
    var generic_icons = {
        "New Document" : [ 
            icons_g.path( icons["doc"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,5]} ),
            icons_g.path( icons["doc"] ).attr( stroke_holder ).attr( {transform: ['t',5,5]} ) ],
        "Render Nubs" : [ 
            icons_g.path( icons["run"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,50]} ),
            icons_g.path( icons["run"] ).attr( stroke_holder ).attr( {transform: ['t',5,50]} ) ],
        "Debug Nubs" : [ 
            icons_g.path( icons["bug"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,95]} ),
            icons_g.path( icons["bug"] ).attr( stroke_holder ).attr( {transform: ['t',5,95]} ) ],
        "Undo last step": [ 
            icons_g.path( icons["undo"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,140]} ),
            icons_g.path( icons["undo"] ).attr( stroke_holder ).attr( {transform: ['t',5,140]} ) ],
        "Redo last Step" : [ 
            icons_g.path( icons["undo"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,185, 's', -1, 1]} ),
            icons_g.path( icons["undo"] ).attr( stroke_holder ).attr( {transform: ['t',5,185, 's', -1, 1]} ) ]
    }
    
    // Add icons to specific
    var specific_icons = {
        "See Nodes" : [ 
            icons_s.path( icons["nodes"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,5]} ),
            icons_s.path( icons["nodes"] ).attr( stroke_holder ).attr( {transform: ['t',5,5]} ) ],
        "Link mode" : [ 
            icons_s.path( icons["link"] ).attr( stroke_holder_outer ).attr( {transform: ['t',5,50]} ),
            icons_s.path( icons["link"] ).attr( stroke_holder ).attr( {transform: ['t',5,50]} ) ]
    }

    var icon_mouseover = function(){
        this.animate({fill:'#89a'},200);
    }
    var icon_mouseout  = function(){
        this.animate({fill:'#456'},200);
    }

    $.each( [ holder_icons, generic_icons, specific_icons ], function(index0,collection){
        $.each(collection,function(index1,elements){
            $.each(elements,function(index2,element){
                element.hover( icon_mouseover, icon_mouseout ).attr({cursor:'pointer',title:index1});
            })
        });
    });

    // Bind Mousewheel Action to miniholder
    $('#miniholder').bind('mousewheel', function(event, delta, deltaX, deltaY) {
        console.log(delta, deltaX, deltaY);
    });

    $(window).mouseup(function(){
        $("#miniholder").html($('#holder').html());
        r2 = Raphael("miniholder", "100%", "100%");
        r2.setViewBox(0,0,$("#miniholder").width(),$("#miniholder").height(),true);
    });

    $(window).keydown(function(e){
        if ( e.ctrlKey || e.metaKey ) {
            console.log("CTRL/META detected ftw!");
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    })

    $(window).resize(
        function(){
            holder_w = $('#holder').width();
            holder_h = $('#holder').height();
            // Repos icons in holder
            holder_icons['Zoom In'][0].attr( {transform: ['t',holder_w-70,10]} );
            holder_icons['Zoom In'][1].attr( {transform: ['t',holder_w-70,10]} );
            holder_icons['Zoom Out'][0].attr( {transform: ['t',holder_w-40,10]} );
            holder_icons['Zoom Out'][1].attr( {transform: ['t',holder_w-40,10]} );
            holder_icons['Move Up'][0].attr( {transform: ['t',holder_w/2-20,5]} );
            holder_icons['Move Up'][1].attr( {transform: ['t',holder_w/2-20,5]} );
            holder_icons['Move Down'][0].attr( {transform: ['t',holder_w/2-20,holder_h-37]} );
            holder_icons['Move Down'][1].attr( {transform: ['t',holder_w/2-20,holder_h-37]} );
            holder_icons['Move Right'][0].attr( {transform: ['t',holder_w-37,holder_h/2-20]} );
            holder_icons['Move Right'][1].attr( {transform: ['t',holder_w-37,holder_h/2-20]} );
            holder_icons['Move Left'][0].attr( {transform: ['t',5,holder_h/2-20]} );
            holder_icons['Move Left'][1].attr( {transform: ['t',5,holder_h/2-20]} );
            $('#miniholder').css({
                width:holder_w*0.17,
                height:holder_h*0.17
            });
            r.safari();
        }
    )
})();
</script>
</html>
